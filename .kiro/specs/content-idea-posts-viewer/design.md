# Design Document

## Overview

The Content Idea Posts Viewer feature enables users to view all social media posts generated by the n8n workflow from a specific content idea. This feature integrates with the existing Baserow-based architecture and adds a new API endpoint and UI components to display linked social media content.

The feature follows the established patterns in the Content Engine application, utilizing the existing BaserowAPI class, client configuration system, and UI component library. The implementation will add an "Open" button to the ContentIdeasTable component and create a new modal/page view to display the generated posts.

## Architecture

### Data Flow
1. User clicks "Open" button on a content idea row
2. Frontend makes API call to fetch social media posts linked to that content idea
3. Baserow API returns all posts where the content idea is referenced in the link field
4. UI displays posts in a modal or dedicated view with post details
5. User can close the view to return to the content ideas table

### Integration Points
- **Baserow API**: Extends existing BaserowAPI class with new method to fetch linked social media posts
- **Client Configuration**: Uses existing client config to access socialMediaContent table ID
- **UI Components**: Integrates with existing ContentIdeasTable and creates new PostsViewer component
- **Routing**: Adds new API route for fetching social media posts by content idea

## Components and Interfaces

### API Layer

#### New BaserowAPI Method
```typescript
// Add to src/lib/baserow/api.ts
async getSocialMediaPostsByContentIdea(socialMediaTableId: string, contentIdeaId: string) {
  // Query social media content table where content_idea_link field matches the content idea ID
  const filters = {
    'filter__content_idea_link__equal': contentIdeaId
  }
  return this.request(`/api/database/rows/table/${socialMediaTableId}/`, {
    method: 'GET',
    // Add query parameters for filtering
  })
}
```

#### New API Route
```typescript
// src/app/api/baserow/[clientId]/social-media-posts/[contentIdeaId]/route.ts
export async function GET(
  request: Request,
  { params }: { params: { clientId: string; contentIdeaId: string } }
) {
  // Fetch social media posts linked to the content idea
  // Return formatted response with post data
}
```

### Frontend Components

#### Enhanced ContentIdeasTable
- Add "Open" button to each content idea card/row
- Button visibility based on whether posts exist for that idea
- Click handler to open posts viewer

#### New PostsViewer Component
```typescript
// src/components/posts/PostsViewer.tsx
interface PostsViewerProps {
  contentIdeaId: string
  contentIdeaTitle: string
  clientId: string
  onClose: () => void
  isOpen: boolean
}

interface SocialMediaPost {
  id: string
  content: string
  platform: string
  status: string
  created_date: string
  scheduled_date?: string
  media_files?: any[]
  content_idea_link: string
}
```

#### Modal Implementation
- Use existing modal pattern from ContentIdeaForm
- Responsive design for mobile and desktop
- Loading states and error handling
- Empty state when no posts found

## Data Models

### Social Media Post Structure
Based on the n8n workflow output, social media posts will have the following structure:

```typescript
interface SocialMediaPost {
  id: string                    // Baserow record ID
  content: string              // Generated post content/text
  platform: string             // Target platform (Facebook, Instagram, LinkedIn, etc.)
  status: string               // Draft, Scheduled, Published, etc.
  created_date: string         // When the post was generated
  scheduled_date?: string      // When the post is scheduled to publish
  media_files?: FileReference[] // Associated images/videos
  content_idea_link: string    // Link back to the original content idea
  hashtags?: string[]          // Generated hashtags
  mentions?: string[]          // Generated mentions
  post_type?: string           // Text, Image, Video, Carousel, etc.
}
```

### API Response Format
```typescript
interface PostsResponse {
  success: boolean
  posts: SocialMediaPost[]
  contentIdea: {
    id: string
    title: string
  }
  totalCount: number
}
```

## Error Handling

### API Error Scenarios
1. **Content idea not found**: Return 404 with appropriate message
2. **Client configuration missing**: Return 400 with configuration error
3. **Baserow API errors**: Return 500 with sanitized error message
4. **No posts found**: Return 200 with empty posts array and appropriate message

### Frontend Error Handling
1. **Network errors**: Show retry button and error message
2. **Loading states**: Display skeleton loaders while fetching
3. **Empty states**: Show helpful message when no posts exist
4. **Permission errors**: Display appropriate access denied message

### Error Messages
- "Unable to load posts. Please try again."
- "No posts have been generated for this content idea yet."
- "This content idea is still being processed. Please check back later."

## Testing Strategy

### Unit Tests
1. **BaserowAPI.getSocialMediaPostsByContentIdea()**: Test filtering and response handling
2. **PostsViewer component**: Test rendering, loading states, and error states
3. **API route**: Test various scenarios (success, errors, empty results)

### Integration Tests
1. **End-to-end flow**: Create content idea → trigger n8n → view generated posts
2. **Cross-client functionality**: Ensure posts are isolated by client
3. **Responsive behavior**: Test modal on different screen sizes

### Test Data Requirements
- Content ideas with linked social media posts
- Content ideas without linked posts
- Various post types and platforms
- Error scenarios (invalid IDs, network failures)

## Implementation Considerations

### Performance
- Implement pagination for large numbers of posts
- Cache post data to avoid repeated API calls
- Lazy load media files and images

### Security
- Validate client access to content ideas and posts
- Sanitize content before display
- Ensure proper authentication for API routes

### Accessibility
- Proper ARIA labels for modal and buttons
- Keyboard navigation support
- Screen reader compatibility
- Focus management when opening/closing modal

### Mobile Responsiveness
- Stack post cards vertically on mobile
- Adjust modal size for smaller screens
- Touch-friendly button sizes
- Swipe gestures for navigation

## Future Enhancements

### Phase 2 Features
- Edit generated posts directly from the viewer
- Bulk actions (approve, schedule, delete multiple posts)
- Post performance metrics integration
- Direct publishing to social platforms

### Advanced Features
- Real-time updates when n8n generates new posts
- Post preview with platform-specific formatting
- Collaboration features (comments, approvals)
- Template management for consistent branding